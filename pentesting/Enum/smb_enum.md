# SMB enumeration






```powershell
sudo nbtscan -r 192.168.50.0/24 #IP or range can be provided

#NSE scripts can be used
locate .nse | grep smb
nmap -p445 --script="name" $IP 

#In windows we can view like this
net view \\<computername/IP> /all

#crackmapexec
crackmapexec smb <IP/range>  
crackmapexec smb 192.168.1.100 -u username -p password
crackmapexec smb 192.168.1.100 -u username -p password --shares #lists available shares
crackmapexec smb 192.168.1.100 -u username -p password --users #lists users
crackmapexec smb 192.168.1.100 -u username -p password --all #all information
crackmapexec smb 192.168.1.100 -u username -p password -p 445 --shares #specific port
crackmapexec smb 192.168.1.100 -u username -p password -d mydomain --shares #specific domain
#Inplace of username and password, we can include usernames.txt and passwords.txt for password-spraying or bruteforcing.


#SMBmap
smbmap -H <target_ip>
smbmap -H <target_ip> -u <username> -p <password>
smbmap -H <target_ip> -u <username> -p <password> -d <domain>
smbmap -H <target_ip> -u <username> -p <password> -r <share_name>

#Within SMB session
put <file> #to upload file
get <file> #to download file
```

- Downloading shares made easy - if the folder consists of several files, they all be downloading by this.

```powershell
mask ""
recurse ON
prompt OFF
mget *
```
















auxiliary/scanner/smb/smb_version
auxiliary/scanner/smb/smb_enumusers
auxiliary/scanner/smb/smb_enumshares
auxiliary/scanner/smb/smb_login # brute force

auxiliary/scanner/smb/pipe_auditor



`smbmap` - SMB enumeration tool

```
smbmap -u guest -p "" -d . -H [TARGET]

smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET]

smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET] -L

smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET] -r [DRIVE]
smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET] -r 'C$'

smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET] --upload '[LOCAL FILE]' '[DEST]'
smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET] --upload '/root/backdoor' 'C$\backdoor'

smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET] --download '[REMOTE FILE]'
smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET] --download  'C$\backdoor'


smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET] -x [COMMAND]
smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET] -x 'ipconfig'


```
