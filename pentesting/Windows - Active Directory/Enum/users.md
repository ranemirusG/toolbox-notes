# Windows - Active Directory User Enumeration

It's not uncommon that the local Administrator accounts across computers in a domain are set up with the same password.


## PowerView

PowerView is a PowerShell tool to gain network situational awareness on Windows domains. It contains a set of pure-PowerShell replacements for various windows "net *" commands, which utilize PowerShell AD hooks and underlying Win32 API functions to perform useful Windows domain functionality.

Is part of PowerSploit.

- <https://powersploit.readthedocs.io/en/latest/Recon/>
- <https://book.hacktricks.xyz/windows-hardening/basic-powershell-for-pentesters/powerview>


List of all Users in the domain. `Get-NetUser` automatically enumerates all attributes on a the user objects:
```
Get-NetUser

Get-NetUser | select [ATTRIBUTE]
Get-NetUser | select cn


# find probable weak users
Get-NetUser | select cn,pwdlastset,lastlogon

```










## Logged users

`PsLoggedOn` from SysInternals Suite.

Will enumerate the registry keys under HKEY_USERS to retrieve the security identifiers (SID) of logged-in users and convert the SIDs to usernames.


One limitation is that `PsLoggedOn` relies on the Remote Registry service in order to scan the associated key. The Remote Registry service has not been enabled by default on Windows workstations since Windows, but system administrators may enable it for various administrative tasks, for backwards compatibility, or for installing monitoring/deployment tools, scripts, agents, etc.

```
PsLoggedon.exe [TARGET HOSTNAME]
.\PsLoggedon.exe \\<computername>

PsLoggedon.exe \\files04
```

Example output:
```
Users logged on locally:
	<unknown time>			CORP\jeffadmin
Users logged on via resource shares:
	10/5/2022 1:33:32 AM	CORP\stephanie
```






-> Enumerate logged users
```
Import-Module .\PowerView.ps1
Get-NetLoggedon -ComputerName <computer_name>
```
https://github.com/PowerShellEmpire/PowerTools/blob/master/PowerView/powerview.ps1

-> Enumerate all active sessions
```
Get-NetSession -ComputerName dc1