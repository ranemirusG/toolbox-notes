# Domain Controller


One or more Domain Controllers act as the hub and core of the domain, storing all OUs, objects, and their attributes.

We should look for the DC that holds the most updated information. This is known a as the Primary Domain Controller (PDC).
*There can be only one PDC in a domain.*
To find the PDC, we need to find the DC holding the `PdcRoleOwner` property.

Members of Domain Admins group are among the most privileged objects in the domain.
If an attacker compromises a member of this group (often referred to as domain administrators), they essentially gain complete control over the domain.

This attack vector could extend beyond a single domain since an AD instance can host more than one domain in a domain tree or multiple domain trees in a domain forest.

While there is a Domain Admins group for each domain in the forest, members of the *Enterprise Admins* group are granted full control over all the domains in the forest and have Administrator privilege on all DCs. This is obviously a high-value target for an attacker.


An AD environment has a critical dependency on the Domain Name System (DNS) service. As such, a typical domain controller 
will also host a DNS server that is authoritative for a given domain.


## Find out domain controller hostname
```
[System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()
```


## PowerView

```
Get-DomainController


Get-DomainComputer
Get-DomainComputer | select samaccountname, name



Get-DomainUser
Get-DomainUser -Identity [USERNAME]

# Identify users with "Do not require Kerberos preauthentication" enabled
# see AS-REP Roasting
Get-DomainUser -PreauthNotRequired


Get-DomainGroup | select name, member

Get-DomainGroupMember -Identity "Domain Admins"
Get-DomainGroupMember -Identity "Domain Admins" -Recurse


Get-NetLoggedon
# on local machine doesn't require to be local admin
Get-NetLoggedon | Select UserName
# For remote computers, you need privileges on that machine
Get-NetLoggedon -ComputerName DC01| Select UserName


Invoke-UserHunter -CheckAccess
# 1. get domain admins members
# 2. get list of computers
# 3. get-netloggedon and get-netsession on each computers
# 4. search if there is an active Domain Admin session in any computer
# 5. set if your user is a local admin on the machine that has the Domain Admin session
```


