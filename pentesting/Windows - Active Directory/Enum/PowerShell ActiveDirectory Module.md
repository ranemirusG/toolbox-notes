### Enumerating Active Directory using PowerShell and .NET Classes

PowerShell cmdlets like `Get-ADUser` work well but they are only installed by default on domain controllers as part of the Remote Server Administration Tools (RSAT).
RSAT is very rarely present on clients in a domain and we must have administrative privileges to install them. 

- <https://learn.microsoft.com/en-us/powershell/module/activedirectory/?view=windowsserver2022-ps>

```

# Check if Active Directory module is available
Get-Module -ListAvailable -Name ActiveDirectory
Get-Module -Name ActiveDirectory


# List all AD Users
Get-ADUser -Filter * | Select-Object Name, SamAccountName

# List all AD Computers
Get-ADComputer -Filter * | Select-Object Name, OperatingSystem

# Create a New AD User
New-ADUser -Name "John Doe" -SamAccountName "jdoe" -UserPrincipalName "jdoe@yourdomain.com" -Path "OU=Users,DC=yourdomain,DC=com" -AccountPassword (Read-Host -AsSecureString "Enter Password") -Enabled $true

# Reset a User's Password
Set-ADAccountPassword -Identity "jdoe" -Reset -NewPassword (ConvertTo-SecureString -AsPlainText "NewPassword123" -Force)


# Check if a Computer is Active
Get-ADComputer -Filter 'Name -eq "ComputerName"' | Select-Object Name, Enabled







Get-ADDomain -Identity [domain]
Get-ADDomain -Current LocalComputer

Get-ADDomain
Get-ADDomain -Current LoggedOnUser

# Identify Your User DN (Distinguished Name)
(Get-ADUser -Identity YourUsername).DistinguishedName

# Search for all objects in the domain
$allObjects = Get-ADObject -Filter * -Properties ntSecurityDescriptor


Get-ADPrincipalGroupMembership [USERNAME]

# Retrieve the permissions for the object we define with the -Path flag 
Get-Acl -Path HKLM:SYSTEM\CurrentControlSet\Services\LanmanServer\DefaultSecurity\ | fl
```




- `GetCurrentDomain()` returns the domain object for the current user.
```
> [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()
...
PdcRoleOwner : DC1.corp.com
...
```







































